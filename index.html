<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Blog on K8s with Flux</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/black.css">
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
		<link rel="stylesheet" href="css/presentation.css">
		<script src="plugin/highlight/highlight.js"></script>
	<body>
		<div class="reveal">
			<div class="slides">


				<section data-transition="convex" data-background="rgb(33, 44, 33)">
               <section data-auto-animate data-transition="convex"">

                  <h2>Blog on K8s with Flux</h2>

                  <p class="righty smaller"><a href="https://twitter.com/flurdy">@flurdy</a></p>

               </section>

					<section data-auto-animate>

						<h2 class="smallest afragment afade-out" data-fragment-index="0">Blog on K8s with Flux</h2>

						<p class="fragment" data-fragment-index="1">Host your own blog</p>
						<p class="fragment" data-fragment-index="2">on Kubernetes</p>
						<p class="fragment" data-fragment-index="3">using gitops with Flux</p>

						<aside class="notes">
							<ul>
								<li>Flux by Weaveworks</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Blog on K8s with Flux</h2>

						<ul>
							<li class="smaller">
								<a href="https://flurdy.github.io/blog-k8s-flux">flurdy.github.io/blog-k8s-flux</a>
								<ul>
									<li><a href="https://github.com/flurdyblog-k8s-flux">github.com/flurdy/blog-k8s-flux</a></li>
								</ul>
								<br/>
							</li>

							<!-- <li class="smaller"><a href="https://github.com/flurdy/lemmings/">github.com/flurdy/lemmings/</a></li> -->

						</ul>

						<aside class="notes">
							<ul>
								<li>Presentation</li>
								<li>Presentation source</li>
								<li>Clone Lemmings</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Blog on K8s with Flux</h2>

						<ul>
							<li>
								Ivar Abrahamsen
								<ul>
									<li><a href="https://twitter.com/flurdy">@flurdy</a></li>
									<!-- <li><a href="https://flurdy.com">flurdy.com</a></li> -->
								</ul>
							</li>

						</ul>

						<aside class="notes">
							<ul>
								<li></li>
							</ul>
						</aside>

					</section>

					<section data-auto->

						<h2 class="smallest" data-fragment-index="0">Blog on K8s with Flux</h2>

						<h4>Contents</h4>

						<ol>
							<li>Introduction</li>
							<li>Blog</li>
							<li>CI build</li>
							<li>Docker Container Registry</li>
							<li>Kubernetes</li>
                     <li><img src="img/fork.png" width="60" alt="road fork"></li>
							<li>GitOps / Flux </li>
							<li>Secrets</li>
							<li>Container Registry II</li>
							<li>Deploy Blog</li>
							<li>Ingress</li>
							<li>Image update</li>
						</ol>

						<aside class="notes">
							<ul>
                        li
							</ul>
						</aside>

					</section>

					<section data-auto-animate data-transition="convex">

						<h2 class="smallest" data-fragment-index="0">Blog on K8s with Flux</h2>

						<h4>Prior Art</h4>

						<ul>
							<li class="smaller"><a href="https://flurdy.com/docs/jekyll/">flurdy.com/docs/jekyll/</a></li>
							<li class="smaller"><a href="https://flurdy.com/docs/kubernetes/kubernetes-101.html">flurdy.com/docs/kubernetes/kubernetes-101.html</a></li>
							<li class="smaller"><a href="https://flurdy.com/docs/kubernetes/kubernetes-ingress-tls-helm.html">flurdy.com/docs/kubernetes/kubernetes-ingress-tls-helm.html</a></li>
							<li class="smaller"><a href="vahttp://flurdy.com/docs/kubernetes/registry/kubernetes-docker-registry.html">flurdy.com/docs/kubernetes/registry/kubernetes-docker-registry.html</a></li>
                     <li class="smaller"><a href="https://github.com/flurdy/lemmings/">github.com/flurdy/lemmings/</a></li>
						</ul>

						<aside class="notes">
							<ul>
								<li>Was going to just rehash these</li>
								<li>But they were too outdated</li>
								<li>Outdated Jekyll</li>
								<li>Ruby gems</li>
								<li>Not all gitops</li>
								<li>Flux 1.x</li>
							</ul>
						</aside>

					</section>
				</section>

				<section data-transition="convex" data-background="rgb(88, 33, 55)">
					<section data-auto-animate data-transition="convex">

						<h2>Blog</h2>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>
					<section data-auto-animate>

						<h2>Blog</h2>

						<ul>
							<li class="fragment">
								Full control
								<ul>
									<li>
										Own your content
									</li>
									<li>Theme as you like</li>
									<li>Not hosted by 3rd party
										<ul>
											<li class="fragment">
												<strike>Medium</strike>,
												<strike>Wordpress.org</strike>,
												<strike>Ghost</strike>,
												<strike>Blogger</strike>
											</li>
										</ul>
									</li>
								</ul>
							<li class="fragment">Simple publish pipeline</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>Own your content</li>
								<li>Not Blogger</li>
								<li>Not Medium</li>
								<li>No hosted Wordpress</li>
								<li>Not Ghost</li>
							</ul>
						</aside>

					</section>
					<section data-auto-animate>

						<h2 class="smallest">Blog</h2>

						<h2 class="smallest">Alternatives</h2>

						<ul class="fragment">
							<li>Hugo</li>
							<li>Gatsby</li>
							<li>Wordpress</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>A reason I have not tried them enough</li>
								<li>Hugo: Go - Fast - Broken templating for me</li>
								<li>Gatsby: Node.js -Never tried properly</li>
								<li>Wordpress: PHP-Security poor</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Blog</h2>

						<h2 class="fragment fade-up">Jekyll</h2>

						<p class="fragment fade-up smaller">
							<a href="https://jekyllrb.com/">jekyllrb.com</a>
						</p>
						<ul class="fragment fade-up">
							<li class="">
								Static pages
							</li>
							<li class="">
								Ruby
							</li>
							<li class="">
								Easy to use templates
							</li>
							<li class="">
								Lots of themes
							</li>
							<li class="">
								Slow generation
							</li>
						</ul>


						<aside class="notes">
							<ul>
								<li class="">
									Huge market share
								</li>
								<li>Github pages</li>
								<li>Generates static HTML pages</li>
								<li>Written in Ruby</li>
								<li>A bit slow in generation</li>
								<li>Static pages are fast</li>
								<li>Lots of free and paid for themes</li>
								<li>Maybe not the latest and shiniest</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Jekyll</h2>

						<h4>Install</h4>

						<p class="fragment fade-in-then-out">Ruby Gem</p>
						<p class="fragment fade-up">Ruby via Docker
							<ul>
								<li class="fragment fade-left">

									<pre class=""><code data-trim data-noescape class="wider language-shell">
										docker pull jekyll/jekyll:4.2.0
									</code></pre>
								</li>
							</ul>

						</p>

						<aside class="notes">
							<ul>
								<li>Polluting local system</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Jekyll</h2>

						<h4 class="">Create blog</h4>
						<div class="fragment">
							<p class="smaller">Create container</p>
							<pre class=""><code data-trim data-noescape class="language-shell">
								docker run --rm --volume="$PWD:/srv/jekyll" \
								-it jekyll/jekyll:4.2.0 /bin/bash
							</code></pre>
						</div>
						<div class="fragment">
							<!-- <p>Create blog </p> -->
							<p class="smaller">(inside container)</p>
							<pre class=""><code data-trim data-noescape class="language-shell">
								jekyll new <em class="custom">myblog</em>
								exit
							</code></pre>
						</div>
						<div class="fragment">
							<p class="smaller">(outside container)</p>
							<pre class=""><code data-trim data-noescape class="language-shell">
								cd <em class="custom">myblog</em>
								git init
								git commit -am "Initial"
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
								<li>$PWD works in bash not in fish</li>
								<li>Using bash inside container</li>
								<li>myblog is whatever you decide</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Jekyll</h2>

						<p>Start Jekyll webserver</p>
						<div class="fragment">
							<p class="smaller">exposing port 4000</>
							<pre class=""><code data-trim data-noescape class="language-shell">
								docker run --rm --volume="$PWD:/srv/jekyll" \
								-p 4000:4000 -it jekyll/jekyll:4.2.0 /bin/bash
							</code></pre>
						</div>
						<div class="fragment">
							<p class="smaller">(inside container)</p>
							<pre class=""><code data-trim data-noescape class="language-shell">
								bundle exec jekyll bundler
							</code></pre>
						</div>
						<div class="fragment">
							<p class="smaller">(outside container)</p>
							<pre class=""><code data-trim data-noescape class="language-shell">
								open http://localhost:4000
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
								<li>exposing port 4000</li>
								<li>Using bash inside container</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="">Jekyll</h2>

						<img src="img/jekyll-default.png"/>

						<aside class="notes">
							<ul>
								<li>Yay</li>
								<li>Edit _config.yml</li>
								<li>Yay</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smaller">Jekyll</h2>

						<h4 class="">Docker Compose</h4>

						<pre class=""><code data-trim data-noescape class="editor language-yaml">
							version: '3'

							services:
							jekyll:
							image: jekyll/jekyll:4.2.0
							container_name: <em class="custom">myblog</em>
							environment:
							- JEKYLL_ENV=docker
							command: jekyll serve --force_polling --livereload --drafts
							ports:
							- 4000:4000
							- 35729:35729
							volumes:
							- ./:/srv/jekyll
						</code></pre>
						<pre class=""><code data-trim data-noescape class="language-bash">
							docker compose up
						</code></pre>

						<aside class="notes">
							<ul>
								<li>Need to reload if editing _config.yml or gemfile</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smaller">Jekyll</h2>

						<h4 class="">Themes</h4>

						<ul>
							<li class="smallest"><a href="https://jekyllthemes.org">jekyllthemes.org</a></li>
							<li class="smallest"><a href="https://jekyll-themes.com">jekyll-themes.com</a></li>
							<li class="smallest"><a href="https://jekyllthemes.io">jekyllthemes.io</a></li>
							<li class="smallest"><a href="https://github.com/jekyll/jekyll/wiki/Themes">github.com/jekyll/jekyll/wiki/Themes</a></li>
							<li class="smallest"><a href="https://github.com/planetjekyll/awesome-jekyll-themes">github.com/planetjekyll/awesome-jekyll-themes</a></li>
							<li class="smallest"><a href="https://talk.jekyllrb.com/t/jekyll-theme-showcase-share-your-jekyll-themes/">talk.jekyllrb.com/t/jekyll-theme-showcase-share-your-jekyll-themes/</a></li>
						</ul>


						<aside class="notes">
							<ul>
								<li>A lot</li>
								<li>Pick one</li>
								<li>Paid or free</li>
								<li>Some as Gems</li>
								<li>Some as Jekyll plugins</li>
								<li>Some as zip</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smaller">Jekyll</h2>


						<h4 class="">Draft</h4>

						<div class="">
							<p class="smaller">(outside container)</p>
							<pre class=""><code data-trim data-noescape class="language-shell">
								touch -p _drafts/my-first-post.md
							</code></pre>
						</div>
						<div class="fragment">
							<pre class=""><code data-trim data-noescape class="language-markdown editor">
								## My first blog post

								Hello everyone
							</code></pre>
						</div>
						<div class="fragment">
							<pre class=""><code data-trim data-noescape class="language-markdown">
								open http://localhost:4000/2021/05/18/my-first-post
							</code></pre>
						</div>
						<div class="fragment">
							<pre class=""><code data-trim data-noescape class="language-bash">
								git add _drafts/my-first-post.md
								git commit -am "First post"
							</code></pre>
						</div>
						<div class="fragment">
							<pre class=""><code data-trim data-noescape class="language-bash">
								gh repo create <em>myblog</em>
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
								<li>in your favourite editor</li>
								<li>Should see the page generation trigger in Jekyll</li>
								<li>If you have Github CLI</li>
								<li>Public repository for now</li>
							</ul>
						</aside>

					</section>
				</section>

				<section data-transition="convex" data-background="rgb(55, 44, 33)">
					<section data-auto-animate data-transition="convex" >

						<h2>CI Build</h2>

						<aside class="notes">
							<ul>
								<li></li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2>CI Build</h2>

						<ul>
							<li class="fragment">Generate static blog pages</li>
							<li class="fragment">Package as Docker image</li>
							<li class="fragment">Upload to container registery</li>
						</ul>

						<aside class="notes">
							<ul>
								<li></li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2>CI Build</h2>

						<h4>Alternatives</h4>

						<ul class="fragment">
							<li>Github Actions</li>
							<li>Travis</li>
							<li>Google Cloud Build</li>
							<li>Gitlab</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>Not tried Gitlan CI parts</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">CI Build</h2>

						<h2>CircleCI</h2>
						<p class="smaller"><a href="https://circleci.com/">circleci.com</a></p>

						<ul class="fragment">
							<li>Free</li>
							<li>Integrates with your Github repositories</li>
							<li>Can build private projects</li>
							<li>Pipelines</li>
							<li>Configuration is a local file so can be in version control</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>Handy build numbering Docker images</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">CircleCI</h2>

						<h4 class="">Set up project</h4>

						<ol>
							<li class="fragment">Log in to circleci.com with Github</li>
							<li class="fragment">On the dashboard, click on Projects on the left</li>
							<li class="fragment">Find our blog repository, and click on <em>"Set up project"</em></li>
						</ol>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>
						<h2 class="smallest">CircleCI</h2>

						<h4 class="">Dockerise project</h4>

						<div class="fragment">
							<pre class=""><code data-trim data-noescape class="language-bash">
								touch Dockerfile
							</code></pre>
						</div>

						<div class="fragment">
							<pre class=""><code data-trim data-noescape class="language-docker editor">
								FROM nginx:1.15-alpine

								COPY _site /usr/share/nginx/html
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">CircleCI</h2>

						<h4 class="">Create configuration</h4>

						<div class="fragment">
							<pre class=""><code data-trim data-noescape class="language-bash">
								mkdir .circleci
								curl -L -O .circleci/config.yml \
								  https://raw.githubusercontent.com/flurdy/blog/master/.circleci/config.yml
							</code></pre>
						</div>

						<div class="fragment">
							<pre class=""><code data-trim data-noescape class="language-yaml editor"
								data-line-numbers="2|3|4-5|7|9-11">
								...
								jobs:
								  build:
								    docker:
									  - image: circleci/ruby:2.6.0-node
								...
								    steps:
								...
								      - run:
								          name: Jekyll build
								          command: bundle exec jekyll build
								...
								    - persist_to_workspace:
								        root: ./
								        paths:
								          - _site
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
								<li>This can be tidied up more</li>
								<li>But it works</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">CircleCI</h2>

						<h4 class="smaller">Create configuration</h4>

						<p class="smaller">Part 2</p>

						<div class="">
							<pre class=""><code data-trim data-noescape class="language-yaml editor"
								data-line-numbers="2|3-4|5-6|10-12">
								...
								  build-image:
								    docker:
									  - image: circleci/buildpack-deps:stretch
								    environment:
									    IMAGE_NAME: quay.io/<em>yourusername</em>/<em>myblog</em>
								...
								    steps:
								...
								      - run:
								          name: Build Docker image
								          command: docker build -t $IMAGE_NAME:latest .
								...
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
								<li>Change image name</li>
								<li>This can be an environment variable</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">CircleCI</h2>

						<h4 class="smaller">Create configuration</h4>

						<p class="smaller">Part 3</p>

						<div class="">
							<pre class=""><code data-trim data-noescape class="language-yaml editor"
								data-line-numbers="2|7|8|9-10|11">
                              ...
                                publish-image:
                              ...
                               - run:
                                  name: Upload to registry
                                  command: |
                                    echo "$DOCKER_PASSWORD" | docker login quay.io -u "$DOCKER_LOGIN" --password-stdin
                                    docker push $IMAGE_NAME:latest
                                    IMAGE_TAG="1.0.${CIRCLE_BUILD_NUM}"
                                    docker tag $IMAGE_NAME:latest $IMAGE_NAME:$IMAGE_TAG
                                    docker push $IMAGE_NAME:$IMAGE_TAG
                             ...
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
								<li>We have not set up the container yet...</li>
								<li>DOCKER_PASSWORD environment variable</li>
								<li>CIRCLE_BUILD_NUM is really useful</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">CircleCI</h2>

						<h4 class="smaller">Create configuration</h4>

						<p class="smaller">Part 4</p>

						<div class="">
							<pre class=""><code data-trim data-noescape class="language-yaml editor"
								data-line-numbers="2|5|6-9|10,14|11-12,15-16">
								...
								workflows:
								  version: 2
								  build-master:
								    - jobs:
								      - build:
								        filters:
								          branches:
								            only: master
								      - build-image:
								        requires:
								          - build
								...
								      - publish-image:
								        requires:
								          - build-image
								...
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">CircleCI</h2>

						<ul>
							<li class="fragment">Typos are your enemy</li>
							<li class="fragment">CircleCI CLI as a linter
								<ul>
									<li class="smaller">
										<a href="https://circleci.com/docs/2.0/local-cli/">circleci.com/docs/2.0/local-cli/</a>
									</li>
								</ul>
							</li>
							<li class="fragment">
								<pre class=""><code data-trim data-noescape class="language-bash">
									circleci config validate
								</code></pre>
							</li>
						</ul>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>
				</section>

				<section data-transition="convex" data-background="rgb(66, 66, 22)">
					<section data-auto-animate data-transition="convex">

						<h2>Docker Container Registry</h2>

						<aside class="notes">
							<ul>
								<li></li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2>Docker Container Registry</h2>

						<ul class="fragment">
							<li>Free or cheap</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>Simple requirements</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Docker Container Registry</h2>

						<h4>Alternatives</h4>

						<ul class="fragment">
							<li>
								Google Container Registry
							</li>
							<li>
								Github packages
							</li>
							<li>
								DigitalOcean Container Registry
							</li>
							<li>
								AWS ECR
							</li>
							<!-- <li>
                        <a href="http://flurdy.com/docs/kubernetes/registry/kubernetes-docker-registry.html">flurdy.com/docs/kubernetes/registry/kubernetes-docker-registry.html</a>
							</li> -->
						</ul>

						<aside class="notes">
							<ul>
								<li>I use GCR for most of my latest private projects</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Docker Container Registry</h2>

						<h2>Quay</h2>

						<p class="smaller"><a href="https://quay.io/">quay.io</a></p>

						<ul class="fragment">
							<li>
								Now owned by Redhat
							</li>
							<li>Free public repositories</li>
							<li>Robot credentials</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>CoreOS</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Quay</h2>

						<ol>
							<li class="fragment">
								Sign up/in
							</li>
							<li class="fragment">
								Create repository
							</li>
							<li class="fragment">
								Create robot account for CircleCI,
								with write permission
							</li>
							<li class="fragment">
								in CircleCI
								<ul>
									<li>Edit Environment variables</li>
									<li>Add Quay robot username as <em>DOCKER_LOGIN</em></li>
									<li>Add Quay robot password as <em>DOCKER_PASSWORD</em></li>
								</ul>
						</ol>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Quay</h2>
						<h2 class="smallest">Publish Jekyll blog</h2>

						<div class="fragment">
							<pre class=""><code data-trim data-noescape class="language-bash">
								git mv _drafts/my-first-post.md _posts/2021-06-18-my-first-post.md
								git commit -am "Published first post"
								git push
							</code></pre>
						</div>

						<ul>
							<li class="fragment">You can monitor the pipeline build in CirclCI</li>
							<li class="fragment">Eventually you can see an image in Quay</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>And later integrate slack for even handier notifications</li>
							</ul>
						</aside>

					</section>
				</section>

				<section data-transition="convex" data-background="rgb(33, 44, 55)">
					<section data-auto-animate data-transition="convex">

						<h2>Kubernetes</h2>

						<p class="smaller fragment"><a href="https://kubernetes.io/">kubernetes.io</a></p>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="">Kubernetes</h2>

						<h4>Install CLI</h4>

						<pre class=""><code data-trim data-noescape class="language-bash">
							brew install kubectl
						</code></pre>

						<p class="smaller">Optionally</p>

						<pre class=""><code data-trim data-noescape class="language-bash">
							brew install kubectx
						</code></pre>

						<pre class=""><code data-trim data-noescape class="language-bash">
							brew install Helm
						</code></pre>

						<aside class="notes">
							<ul>
								<li>On linux I also used the Homebrew version</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2>Kubernetes</h2>

						<ul>
							<li>Reasonable price</li>
							<li>Ingress support</li>
							<li>Full Kubernetes access</li>
							<li>Reliable</li>
							<li>Up to date</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>Only paying for nodes is a bonus</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Kubernetes</h2>

						<h4>Alternatives</h4>

						<ul class="fragment">
							<li>GKE - Google Kubernetes Engine</li>
							<li>EKS - AWS Kubernetes Service</li>
							<li>AKS - Azure Kubernetes Service</li>
							<li>The Hard Way</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>GKE most feature rich and up to date</li>
								<li>GKE increased prices</li>
								<li>AKS not bad actually</li>
								<li>EKS was initially expensive</li>
								<li>EKS has reduced prices</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Kubernetes</h2>

						<h2>DigitalOcean Kubernetes</h2>
						<p class="smaller">(DOKS)</p>
						<p class="smaller"><a href="https://m.do.co/c/fea5b8fd61fa">digitalocean.com/products/kubernetes/</a></p>

						<ul class="fragment">
							<li>Simple to use</li>
							<!-- <li>Full access</li> -->
							<li>Only pay for worker nodes</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>not awful UI</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">DigitalOcean Kubernetes</h2>

						<h4>Install DO's CLI</h4>

						<pre class=""><code data-trim data-noescape class="language-bash">
							brew install doctl
						</code></pre>

						<aside class="notes">
							<ul>

							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">DigitalOcean Kubernetes</h2>

						<h4>Create cluster</h4>

						<ol>
							<li class="fragment">Sign up / sign in (<a href="https://m.do.co/c/fea5b8fd61fa">referral</a>)</li>
							<li class="fragment">Go to Kubernetes page and click Create / Kubernetes cluster</li>
							<li class="fragment">Change cluster name at the bottom, e.g. <em>doubledragon-01</em></li>
						</ol>


						<aside class="notes">
							<ul>
								<li class="">Default node pool is ok for now</li>
								<li class="fragment">Click create at the bottom and wait a little</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate data-transition="convex">

						<h2 class="smallest">DigitalOcean Kubernetes</h2>

						<h4>Connect to cluster</h4>

						<ol>
							<li class="fragment">
								In the 3rd section of the <em>Getting Started</em> part,
								<ul>
									<li>
										Copy and execute the <em>doctl</em> line to download the cluster config,

									</li>
								</ul>
							</li>
							<li class="fragment">
								<pre><code data-trim data-noescape class="language-bash">
									doctl kubernetes cluster kubeconfig save <em>1234-1234-41234</em>
								</code></pre>
							</li>
							<li class="fragment">
								Test with <em>kubectx</em> if the <em>kubectl</em> context is correct
							</li>
							<li class="fragment">Click through the rest of the <em>Getting Started</em> steps</li>
							<li class="fragment">
								Test <em>kubectl</em> connection with
								<ul>
									<li>
										<pre class=""><code data-trim data-noescape class="language-bash">
											kubectl cluster-info
										</code></pre>
									</li>
								</ul>
							</li>
						</ol>


						<aside class="notes">
							<ul>
								<li>Something UUID like:</li>
							</ul>
						</aside>

					</section>
				</section>

				<section data-transition="convex" data-background="rgb(75, 55, 75)">
					<section data-auto-animate data-transition="convex">

                  <img src="img/fork.png" width="400" alt="road fork">

                  <ul>
                     <li>GitOps</li>
                     <li><strike>GitOps</strike></li>
                  </ul>

						<aside class="notes">
							<ul>
								<li>Blue or red pill</li>
                        <li>Standard manual Kuberenetes</li>
							</ul>
						</aside>

					</section>

					</section>
				</section>

				<section data-transition="convex" data-background="rgb(33, 66, 33)">
					<section data-auto-animate data-transition="convex">

						<h2>GitOps</h2>

						<aside class="notes">
							<ul>
								<li></li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2>GitOps</h2>

						<ul>
							<li>Version controlled cluster state</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>Championed by WeaveWorks</li>
								<li>In Kuberenetes context</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Gitops</h2>

						<h2 class="smallest">Alternatives</h2>

						<ul>
							<li>Argo</li>
							<li>Keel</li>
							<li>Terraform et al</li>
						</ul>

						<aside class="notes">
							<ul>
								<li></li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Gitops</h2>

						<h2 class="">Flux</h2>

						<p class="smaller"><a href="https://fluxcd.io/">fluxcd.io</a></p>

						<ul class="fragment">
							<li class="">WeaveWorks</li>
							<li class="">Declarative</li>
							<li >Automated</li>
						</ul>

						<aside class="notes">
							<ul>
								<li></li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Flux</h2>

                  <div>

                     <img src="img/gitops-toolkit.png" width="600" alt="toolkit">
                  </div>

						<ul>
                     <li>Recently v2 has been released</li>
						</ul>

						<aside class="notes">
							<ul>
								<li>I used v1 a lot</li>
								<li>Links at the end</li>
								<li>v2 is different</li>
								<li>More modular</li>
								<li>Kustomization</li>
								<li>Multi-cluster (environment)</li>
								<li>Multi-tenant</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Flux</h2>

						<h4>Install Flux CLI</h4>

						<div class="fragment">
							<pre><code data-trim data-noescape class="language-bash">
								brew install fluxcd/tap/flux
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
								<li>Like all the other tools...</li>
								<li>bask completions</li>
								<li>zsh and fish etc</li>
							</ul>
						</aside>
					</section>

					<section data-auto-animate>

						<h2 class="smallest">Flux</h2>

						<h4>Github auth</h4>

						<div class="fragment">
							<pre><code data-trim data-noescape class="language-bash">
								export GITHUB_USER=<em>your-username</em>
								export GITHUB_TOKEN=<em>your-token</em>
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
								<li>Personal access token</li>
							</ul>
						</aside>
					</section>

					<section data-auto-animate>

						<h2 class="smallest">Flux</h2>

						<h4>Initialise</h4>

						<div class="fragment">
							<ul>
								<li>Verify cluster connection</li>
							</ul>
							<pre><code data-trim data-noescape class="language-bash">
								flux check --pre
							</code></pre>
						</div>
						<div class="fragment">
							<ul>
								<li>Bootstrap flux</li>
							</ul>
							<pre><code data-trim data-noescape class="language-bash">
								flux bootstrap github \
								--owner=$GITHUB_USER \
								--repository=<em>fleet-doubledragon</em> \
								--branch=main \
								--path=./clusters/<em>doubledragon-prod</em> \
								--personal
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
								<li>The bootstrap will create the Github repo</li>
                        <li>Idempotent</li>
							</ul>
						</aside>
					</section>

					<section data-auto-animate>

						<h2 class="smallest">Flux</h2>

						<h4>Initialised</h4>

						<div class="fragment">
							<pre><code data-trim data-noescape class="language-bash">
								git clone https://github.com/$GITHUB_USER/<em>fleet-doubledragon</em>
								cd <em>fleet-doubledragon</em>
								tree
							</code></pre>
                     <div class="smaller">
                        <pre><code data-trim data-noescape class="language-bash editor editorgreen">
                           <em>fleet-doubledragon</em>/
                           ├── clusters/
                           │   └── <em>doubledragon-prod</em>/
                           │       └── flux-system/
                           │           ├── gotk-components.yaml
                           │           ├── gotk-sync.yaml
                           │           └── kustomization.yaml
                           └── README.md
                        </code></pre>
                     </div>
						</div>
						<div class="fragment">
							<pre><code data-trim data-noescape class="language-bash">
								kubectl get all -n flux-system
							</code></pre>
						</div>

						<aside class="notes">
							<ul>
							</ul>
						</aside>
					</section>
            </section>

				<section data-transition="convex" data-background="rgb(11, 11, 11">
					<section data-auto-animate data-transition="convex">

						<h2>Secrets</h2>

						<aside class="notes">
							<ul>
								<li>You don't want clear text secrets in Git</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

                  <h2 class="smallest">Secrets</h2>

                  <h2>Alternatives</h2>

                  <ul>
                     <li>Manual Kubernetes secrets</li>
                     <li>
                        Mozilla's SOPS
                     </li>
                  </ul>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

                  <h2 class="smallest">Secrets</h2>

                  <h2>Sealed Secrets</h2>

						<p class="smaller"><a href="https://github.com/bitnami-labs/sealed-secrets">github.com/bitnami-labs/sealed-secrets</a></p>


						<aside class="notes">
							<ul>
                        <li>Encrypted in Git</li>
                        <li>Decrypted in runtime...</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

                  <h2 class="smallest">Sealed Secrets</h2>

                  <h4>Install CLI</h4>

						<pre><code data-trim data-noescape class="language-bash">
                     brew install kubeseal
						</code></pre>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

                  <h2 class="smallest">Sealed Secrets</h2>

                  <h4>Helm chart</h4>

                  <p class="smaller">Add Helm repository</p>

						<pre><code data-trim data-noescape class="language-bash">
                     flux create source helm sealed-secrets \
                       --interval=2h \
                       --url=https://bitnami-labs.github.io/sealed-secrets
						</code></pre>

                  <p class="smaller">Create Helm release</p>

						<pre><code data-trim data-noescape class="language-bash">
                     flux create helmrelease sealed-secrets \
                       --interval=2h \
                       --release-name=sealed-secrets \
                       --target-namespace=flux-system \
                       --source=HelmRepository/sealed-secrets \
                       --chart=sealed-secrets \
                       --chart-version=">=1.15.0-0" \
                       --crds=CreateReplace
						</code></pre>

						<pre><code data-trim data-noescape class="language-bash">
                     git add sealed-secrets-source ???
                     git add sealed-secrets-release ???
						</code></pre>

						<aside class="notes">
							<ul>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

                  <h2 class="smallest">Sealed Secrets</h2>

                  <h4>Public key</h4>

						<pre><code data-trim data-noescape class="language-bash">
                     cd clusters/<em>doubledragon-prod</em>
                     mkdir secrets
                     kubeseal --fetch-cert \
                       --controller-name=sealed-secrets \
                       --controller-namespace=flux-system \
                       > secrets/pub-sealed-secrets.pem
                     git add secrets/pub-sealed-secrets.pem
						</code></pre>

						<aside class="notes">
							<ul>
                        <li>Will use this next for registry auth</li>
							</ul>
						</aside>

					</section>
            </section>

				<section data-transition="convex" data-background="rgb(75, 75, 11">
					<section data-auto-animate data-transition="convex">

						<h2 class="">Container Registry</h2>
						<h2 class="fragment">Part Deux</h2>

						<aside class="notes">
							<ul>
								<li>Adding it to the cluster</li>
								<li>Secrets</li>
							</ul>
						</aside>
					</section>

					<section data-auto-animate data-transition="convex" >

						<h2 class="smallest">Container Registry</h2>

                  <p class="smaller">Create secret</p>

						<pre><code data-trim data-noescape class="language-bash">
                     cd clusters/<em>doubledragon-prod</em>
                     mkdir registry
						</code></pre>

						<pre><code data-trim data-noescape class="language-bash">
                     kubectl create secret docker-registry <em>quay-registry</em> \
                       --dry-run
                       --docker-server=quay.io \
                       --docker-username:<em>MYROBOTUSER</em> \
                       --docker-password=<em>MYROBOTPASSWORD</em> \
                       -o yaml &gt; registry/<em>quay-clear.yml</em>
						</code></pre>

						<aside class="notes">
							<ul>
								<li></li>
							</ul>
						</aside>
					</section>
					<section data-auto-animate data-transition="convex" >

						<h2 class="smallest">Container Registry</h2>

                  <p class="smaller">Encrypt secret</p>

						<pre><code data-trim data-noescape class="language-bash">
                     kubeseal --format=yaml \
                       --cert=secrets/pub-sealed-secrets.pem \
                       &lt; registry/<em>quay-clear.yml</em> \
                       &gt; registry/<em>quay-encrypted.yml</em>
						</code></pre>

						<pre><code data-trim data-noescape class="language-bash">
                     git add registry/<em>quay-encrypted.yml</em>
                     rm registry/<em>quay-clear.yml</em>
						</code></pre>

                  <div class="fragment">

                     <p class="smaller">Verify</p>

                     <pre><code data-trim data-noescape class="language-bash">
                        git commit -m "registry added"
                        git push
                     </code></pre>
                     <pre><code data-trim data-noescape class="language-bash">
                        kubectl get secret,sealedsecret
						   </code></pre>
                 </div>

						<aside class="notes">
							<ul>
								<li>kubectl describe</li>
							</ul>
						</aside>
					</section>

            </section>

				<section data-transition="convex" data-background="rgb(75, 11, 75">
					<section data-auto-animate data-transition="convex">

						<h2 class="">Deploy Blog</h2>

						<aside class="notes">
							<ul>
								<li></li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Deploy Blog</h2>

                  <ul>
                     <li><strike>Kustomize</strike></li>
                     <li><strike>GitRepository</strike></li>
                     <li><strike>Certificate</strike></li>
                  </ul>

						<aside class="notes">
							<ul>
                        <li>Not enough time</li>
                        <li>All the YAML</li>
							</ul>
						</aside>

					</section>

					<section data-auto-animate>

						<h2 class="smallest">Deploy Blog</h2>

                  <h4>Create Namespace</h4>

						<pre><code data-trim data-noescape class="language-bash">
                     mkdir -p clusters/<em>doubledragon-prod</em>/<em>arcade</em>
                     cd clusters/<em>doubledragon-prod</em>/<em>arcade</em>
                     touch namespace.yml
						</code></pre>

                  <div class="smaller">
                     <pre><code data-trim data-noescape class="language-yaml editor">
                        apiVersion: v1
                        kind: Namespace
                        metadata:
                          name: <em>arcade</em>
                     </code></pre>
                  </div>

						<pre><code data-trim data-noescape class="language-bash">
                     git add namespace.yml
                     git commit -m "Added <em>arcade</em> namespace"
                     git push
						</code></pre>

						<aside class="notes">
							<ul>
                        <li>Free to organise folder structure</li>
                        <li>Maybe apps as root folder if multi clusters/environments</li>
							</ul>
						</aside>
					</section>

					<section data-auto-animate>

						<h2 class="smallest">Deploy Blog</h2>

                  <h4>Create Deployment</h4>

                  <div class="fragment">
                     <pre><code data-trim data-noescape class="language-bash">
                        mkdir <em>myblog</em>
                        touch <em>myblog</em>/deployment.yml
                     </code></pre>

                     <div class="smaller">
                        <pre><code data-trim data-noescape class="language-yaml editor" data-line-numbers="4|6|19|22-23">
                        apiVersion: apps/v1
                        kind: Deployment
                        metadata:
                        name: <em>myblog</em>-deployment
                        annotations:
                           fluxcd.io/automated: "true"
                        spec:
                        selector:
                           matchLabels:
                              app: <em>myblog</em>
                        replicas: 2
                        template:
                           metadata:
                              labels:
                              app: <em>myblog</em>
                           spec:
                              containers:
                              - name: <em>myblog</em>-container
                              image: quay.io/<em>yourusername</em>/<em>myblog</em>:<em>1.0.1</em>
                              ports:
                              - containerPort: 80
                              imagePullSecrets:
                              - name: <em>quay-registry</em>
                        </code></pre>
                     </div>

                  </div>

                  <div class="fragment">
                     <pre><code data-trim data-noescape class="language-bash">
                        git add <em>myblog</em>/deployment.yml
                     </code></pre>
                  </div>

						<aside class="notes">
							<ul>
                        <li>Check in quay what the current semver version is</li>
                        <li>After the initial deploy this will be automated</li>
								<li>Instead of myblog you might have myblog.example.com</li>
							</ul>
						</aside>
					</section>

					<section data-auto-animate>

						<h2 class="smallest">Deploy Blog</h2>

                  <h4>Create Service</h4>

                  <div class="fragment">
                     <pre><code data-trim data-noescape class="language-bash">
                        touch <em>myblog</em>/service.yml
                     </code></pre>

                     <div class="smaller">
                        <pre><code data-trim data-noescape class="language-yaml editor">
                           apiVersion: v1
                           kind: Service
                           metadata:
                             name: <em>myblog</em>-service
                           spec:
                             selector:
                               app: <em>myblog</em>
                             ports:
                             - protocol: TCP
                               port: 80
                               targetPort: 80
                        </code></pre>
                     </div>

                     <pre><code data-trim data-noescape class="language-bash">
                        git add <em>myblog</em>/service.yml
                     </code></pre>
                  </div>

						<aside class="notes">
							<ul>
                        <li>Service can be load balancer if only service in cluster</li>
							</ul>
						</aside>
					</section>

					<section data-auto-animate>

						<h4 class="smallest">Deploy Blog</h4>

                  <p class="smaller">Monitor rollout</p>

                  <pre><code data-trim data-noescape class="language-bash">
                     git commit -m "Added <em>myblog</em>"
                     git push
                  </code></pre>

						<pre><code data-trim data-noescape class="language-bash">
                     watch flux get kustomizations
						</code></pre>

						<pre><code data-trim data-noescape class="language-bash">
                     watch kubectl -n default get deployments,services
						</code></pre>

                  <div class="smallest">
                     <pre><code data-trim data-noescape class="language-bash editor">
                        NAME                     READY   UP-TO-DATE   AVAILABLE   AGE
                        deployment.apps/<em>myblog</em>   2/2     2            2           108s

                        NAME                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)             AGE
                        service/<em>myblog</em>      ClusterIP   10.100.149.126   <none>             9898/TCP,9999/TCP   108s
                     </code></pre>
                  </div>

						<aside class="notes">
							<ul>
                        <li>Watch as the cluster state syncs</li>
                        <li>No ingress yet</li>
                        <li>No external ip</li>
                        <li>Can tunnel in</li>
                        <li>Or launch as NodeIp.</li>
							</ul>
						</aside>
					</section>
            </section>

            <section data-transition="convex" data-background="rgb(160, 130, 0">
               <section data-auto-animate data-transition="convex">

                  <h2 class="">Ingress</h2>

                  <aside class="notes">
                     <ul>
                        <li></li>
                     </ul>
                  </aside>

               </section>

               <section data-auto-animate>

                  <h2 class="smallest">Ingress</h2>

                  <h2>Alternatives</h2>
                  <ul>
                     <li>HAProxy</li>
                     <li>Istio</li>
                     <li>Traefik</li>
                     <li>Envoy</li>
                     <li>Kong</li>
                     <li>Nginx.org</li>
                     <li>GCP, AKS, EKS ingress</li>
                  </ul>

                  <aside class="notes">
                     <ul>
                        <li>Service mesh</li>
                        <li>API Gateway</li>
                        <li>Nginx plus</li>
                     </ul>
                  </aside>
               </section>

               <section data-auto-animate>

                  <h2 class="smallest">Ingress</h2>

                  <h2>Nginx</h2>

                  <p class="smallest fragment">Ingress-nginx</p>

                  <aside class="notes">
                     <ul>
                        <li>Maintained by Kubernetes team</li>
                        <li>Config map</li>
                     </ul>
                  </aside>
               </section>

               <section data-auto-animate>

                  <h2 class="smallest">Ingress</h2>

                  <h2 class="smallest">Nginx</h2>

						<pre><code data-trim data-noescape class="language-bash">
                     flux create source helm nginx \
                       --url https://kubernetes-charts.storage.googleapis.com
                     flux create helmrelease --chart <em>my-nginx</em> \
                       --source HelmRepository/nginx \
                       --chart-version <em>1.26.1</em> \
                       --namespace nginx
						</code></pre>

                  <aside class="notes">
                     <ul>
                        <li>Should create and add to git a repo and release</li>
                     </ul>
                  </aside>
               </section>

					<section data-auto-animate>

                  <h2 class="smallest">Ingress</h2>

						<h2 class="smallest">Blog Ingress</h2>

                  <p class="smaller">Create Ingress</p>

                  <div class="fragment">
                     <pre><code data-trim data-noescape class="language-bash">
                        touch clusters/<em>doubledragon-prod</em>/<em>arcade</em>/<em>myblog</em>/ingress.yml
                     </code></pre>

                     <div class="smaller">
                        <pre><code data-trim data-noescape class="language-yaml editor" data-line-numbers="4|9|11|13">
                           apiVersion: extensions/v1beta1
                           kind: Ingress
                           metadata:
                             name: <em>myblog</em>-ingress
                             annotations:
                               kubernetes.io/ingress.class: nginx
                           spec:
                             rules:
                             - host: <em>myblog.example.com</em>
                               http:
                                 paths:
                                 - backend:
                                     serviceName: <em>myblog</em>-service
                                     servicePort: 80

                        </code></pre>
                     </div>

                     <pre><code data-trim data-noescape class="language-bash">
                        git add clusters/<em>doubledragon-prod</em>/<em>arcade</em>/<em>myblog</em>/ingress.yml
                     </code></pre>
                  </div>

						<aside class="notes">
							<ul>
                        <li>catchall</li>
							</ul>
						</aside>
					</section>

					<section data-auto-animate>

						<h2 class="smallest">Blog Ingress</h2>

                  <p class="smaller">Publish</p>

                  <div class="fragment">
                     <pre><code data-trim data-noescape class="language-bash">
                        git commit -m "<em>myblog</em> ingress"
                        git push
                     </code></pre>

                     <div class="fragment">
                        <p class="smaller">Monitor</p>

                        <pre><code data-trim data-noescape class="language-bash">
                        watch kubectl get ingress
                        </code></pre>

                        <div class="smaller">
                           <pre><code data-trim data-noescape class="language-bash editor">
                              NAME             HOSTS               ADDRESS  PORTS  AGE
                              <em>myblog</em>-ingress   <em>myblog.example.com</em>  <em>5.4.3.2</em>  80     3s
                           </code></pre>
                        </div>
                     </div>

                     <div class="fragment">

                        <p class="smaller">Test</p>

                        <div class="smaller">
                           <pre><code data-trim data-noescape class="language-bash">
                              curl -H "Host: <em>myblog.example.com</em>" \
                                 --resolve <em>hello.example.com</em>:80:<em>5.4.3.2</em> \
                                 http://<em>myblog.example.com</em> | lynx -stdin
                           </code></pre>
                        </div>
                     </div>

                  </div>

						<aside class="notes">
							<ul>
                        <li>catchall</li>
							</ul>
						</aside>
               </section>
            </section>

            <section data-transition="convex" data-background="rgb(0, 100, 128">
               <section data-auto-animate data-transition="convex">

                  <h2 class="">Image update</h2>

                  <aside class="notes">
                     <ul>
                        <li>Threw my toys</li>
                     </ul>
                  </aside>

               </section>

               <section data-auto-animate>

                  <h2 class="smallest">Image update</h2>

                  <ul>
                     <li>Polls repository for image versions</li>
                     <li>Included in v1</li>
                     <li>Alpha in v2</li>
                  </ul>

                  <aside class="notes">
                     <ul>
                        <li>Threw my toys</li>
                        <li>(June 2021)</li>
                     </ul>
                  </aside>

               </section>

               <section data-auto-animate>

                  <h2 class="smallest">Image update</h2>

                  <p class="smaller">Image repository</p>

                  <div class="">
                     <pre><code data-trim data-noescape class="language-bash">
                        cd ./clusters/<em>doubledragon-prod</em>
                        flux create image repository <em>myblog</em> \
                          --image=quay.io/<em>yourusername</em>/<em>myblog</em> \
                          --interval=5m \
                          --export &gt; ./<em>arcade</em>/<em>myblog</em>/registry.yaml
                     </code></pre>
                  </div>
                  <p class="smaller">Image policy</p>

                  <div class="">
                     <pre><code data-trim data-noescape class="language-bash">
                        flux create image policy <em>myblog</em> \
                          --image-ref=<em>myblog</em> \
                          --select-semver=<em>1.0.x</em>
                          --export &gt; ./<em>arcade</em>/<em>myblog</em>/policy.yaml
                     </code></pre>
                  </div>


                  <aside class="notes">
                     <ul>
                        <li>A bit Keel semver</li>
                     </ul>
                  </aside>

               </section>
               <section data-auto-animate>

                  <h2 class="smallest">Image update</h2>


                  <div class="">
                     <pre><code data-trim data-noescape class="language-bash">
                        git add <em>arcade</em>/<em>myblog</em>/registry.yaml
                        git add <em>arcade</em>/<em>myblog</em>/policy.yaml
                        git commit -m "image scan"
                        git push
                     </code></pre>
                  </div>

                  <p class="smaller">Force Flex to pull</p>

                  <div class="">
                     <pre><code data-trim data-noescape class="language-bash">
                        flux reconcile kustomization flux-system --with-source
                     </code></pre>
                  </div>

                  <p class="smaller">List images found</p>

                  <div class="">
                     <pre><code data-trim data-noescape class="language-bash">
                        flux get image repository <em>myblog</em>
                        flux get image policy <em>myblog</em>
                     </code></pre>
                  </div>


                  <aside class="notes">
                     <ul>
                     </ul>
                  </aside>

               </section>

            </section>

			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<!-- <script src="plugin/markdown/markdown.js"></script> -->
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			Reveal.initialize({
				controlsTutorial: true,
				hash: true,
				plugins: [ RevealHighlight, RevealNotes ],
				slideNumber: true,
				showSlideNumber: "speaker",
				totalTime: 1800,
				transition: "convex"
			});
		</script>
	</body>
</html>
